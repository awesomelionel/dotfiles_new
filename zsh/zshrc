# ============================================================================
# Modern ZSH Configuration
# ============================================================================

# -----------------------------------------------------------------------------
# Oh My Zsh Setup
# -----------------------------------------------------------------------------
export ZSH="$HOME/.oh-my-zsh"

# Modern theme suggestions (or consider Starship/Powerlevel10k)
ZSH_THEME="robbyrussell"  # Clean default, or try: "agnoster", "powerlevel10k/powerlevel10k"

# Oh My Zsh settings
CASE_SENSITIVE="false"
HYPHEN_INSENSITIVE="true"
DISABLE_AUTO_UPDATE="false"
DISABLE_UPDATE_PROMPT="false"
export UPDATE_ZSH_DAYS=7
COMPLETION_WAITING_DOTS="true"
HIST_STAMPS="yyyy-mm-dd"

# -----------------------------------------------------------------------------
# Plugins (modern, useful selection)
# -----------------------------------------------------------------------------
plugins=(
  git
  zsh-autosuggestions      # Install: git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
  zsh-syntax-highlighting  # Install: git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
  docker
  docker-compose
  npm
  node
  sudo                     # Press ESC twice to prefix with sudo
  copypath                 # Copy current path to clipboard
  copyfile                 # Copy file contents to clipboard
  web-search              # Google search from terminal
)

source $ZSH/oh-my-zsh.sh

# -----------------------------------------------------------------------------
# Environment Variables
# -----------------------------------------------------------------------------
export EDITOR='vim'       # or 'nvim', 'code', 'nano'
export VISUAL='vim'

# Language environment
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# -----------------------------------------------------------------------------
# PATH Configuration
# -----------------------------------------------------------------------------
# Homebrew (Apple Silicon)
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"

# User binaries
export PATH="$HOME/bin:$HOME/.local/bin:$PATH"

# System paths
export PATH="/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH"

# Go
export GOPATH="$HOME/go"
export PATH="$PATH:$GOPATH/bin"

# Node (if using nvm, add this)
# export NVM_DIR="$HOME/.nvm"
# [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Python (if needed)
# export PATH="$HOME/.local/bin:$PATH"

# Rust (if needed)
# export PATH="$HOME/.cargo/bin:$PATH"

# -----------------------------------------------------------------------------
# Ruby Configuration (chruby)
# -----------------------------------------------------------------------------
if [ -f /opt/homebrew/opt/chruby/share/chruby/chruby.sh ]; then
  source /opt/homebrew/opt/chruby/share/chruby/chruby.sh
  source /opt/homebrew/opt/chruby/share/chruby/auto.sh
  chruby ruby-3.3.0
fi

# -----------------------------------------------------------------------------
# History Configuration
# -----------------------------------------------------------------------------
HISTSIZE=10000
SAVEHIST=10000
setopt EXTENDED_HISTORY          # Write timestamp to history file
setopt HIST_EXPIRE_DUPS_FIRST    # Expire duplicate entries first
setopt HIST_IGNORE_DUPS          # Don't record duplicates
setopt HIST_IGNORE_SPACE         # Don't record commands starting with space
setopt HIST_VERIFY               # Show command before executing from history
setopt SHARE_HISTORY             # Share history between sessions

# -----------------------------------------------------------------------------
# Key Bindings
# -----------------------------------------------------------------------------
bindkey '^P' up-history
bindkey '^N' down-history
bindkey '^?' backward-delete-char
bindkey '^h' backward-delete-char
bindkey '^w' backward-kill-word

# -----------------------------------------------------------------------------
# Modern Aliases - File & Directory Operations
# -----------------------------------------------------------------------------
alias ls='ls -G'                    # Colorize ls (macOS)
alias ll='ls -lah'                  # Long listing with hidden files
alias la='ls -A'                    # Show hidden files
alias l='ls -CF'                    # Compact listing

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

alias cl='clear'
alias c='clear'

# Modern cat replacement (if bat is installed)
if command -v bat &> /dev/null; then
  alias cat='bat'
  alias c='bat'
else
  # Fallback to traditional pygmentize if available
  if command -v pygmentize &> /dev/null; then
    alias c='pygmentize -O style=monokai -f console256 -g'
  fi
fi

# Modern ls replacement (if eza/exa is installed)
if command -v eza &> /dev/null; then
  alias ls='eza --icons'
  alias ll='eza -lah --icons --git'
  alias tree='eza --tree --icons'
elif command -v exa &> /dev/null; then
  alias ls='exa --icons'
  alias ll='exa -lah --icons --git'
  alias tree='exa --tree --icons'
fi

# -----------------------------------------------------------------------------
# Config File Shortcuts
# -----------------------------------------------------------------------------
alias zshconfig='$EDITOR ~/.zshrc'
alias zshreload='source ~/.zshrc'
alias vimrc='$EDITOR ~/.vimrc'
alias tmuxconfig='$EDITOR ~/.tmux.conf'
alias hosts='sudo $EDITOR /etc/hosts'

# -----------------------------------------------------------------------------
# Git Aliases (additional to oh-my-zsh git plugin)
# -----------------------------------------------------------------------------
alias gs='git status'
alias glog='git log --oneline --decorate --graph --all'
alias gca='git commit -a'
alias gp='git push'
alias gl='git pull'

# -----------------------------------------------------------------------------
# Development Tools
# -----------------------------------------------------------------------------
# Modern HTTP server (Python 3)
alias server='python3 -m http.server'
alias serve='python3 -m http.server'

# Docker helpers
alias dps='docker ps'
alias dpsa='docker ps -a'
alias di='docker images'
alias dclean='docker system prune -a'
alias dstop='docker stop $(docker ps -q)'

# -----------------------------------------------------------------------------
# Network & System Utilities
# -----------------------------------------------------------------------------
# Modern IP address lookup
alias localip="ipconfig getifaddr en0"  # WiFi on modern Macs
alias publicip='curl -s https://api.ipify.org'
alias ips="ifconfig -a | grep -oE 'inet6? (\S+)' | awk '{print \$2}'"

# DNS flush (modern macOS)
alias dnsflush='sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder'

# Network monitoring (updated interface names)
alias ports='netstat -tulanp'

# Show/hide hidden files in Finder
alias showfiles='defaults write com.apple.finder AppleShowAllFiles YES; killall Finder'
alias hidefiles='defaults write com.apple.finder AppleShowAllFiles NO; killall Finder'

# -----------------------------------------------------------------------------
# Productivity Aliases
# -----------------------------------------------------------------------------
# Quick navigation
alias projects='cd ~/Projects'
alias docs='cd ~/Documents'
alias downloads='cd ~/Downloads'

# Find and kill process by name
fkill() {
  local pid
  pid=$(ps -ef | sed 1d | fzf -m | awk '{print $2}')
  if [ "x$pid" != "x" ]; then
    echo $pid | xargs kill -${1:-9}
  fi
}

# Make directory and cd into it
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Extract any archive
extract() {
  if [ -f $1 ]; then
    case $1 in
      *.tar.bz2)   tar xjf $1     ;;
      *.tar.gz)    tar xzf $1     ;;
      *.bz2)       bunzip2 $1     ;;
      *.rar)       unrar e $1     ;;
      *.gz)        gunzip $1      ;;
      *.tar)       tar xf $1      ;;
      *.tbz2)      tar xjf $1     ;;
      *.tgz)       tar xzf $1     ;;
      *.zip)       unzip $1       ;;
      *.Z)         uncompress $1  ;;
      *.7z)        7z x $1        ;;
      *)           echo "'$1' cannot be extracted via extract()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# -----------------------------------------------------------------------------
# FZF Configuration (fuzzy finder)
# -----------------------------------------------------------------------------
# Install: brew install fzf
if command -v fzf &> /dev/null; then
  [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
  export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
  export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
fi

# -----------------------------------------------------------------------------
# Load Custom Configurations
# -----------------------------------------------------------------------------
# Source additional config files if they exist
for file in $HOME/dotfiles/.{aliases,functions,private}; do
  [ -r "$file" ] && [ -f "$file" ] && source "$file"
done
unset file

# Work-specific configurations (if exists)
[ -f ~/.zshrc.work ] && source ~/.zshrc.work

# Local machine-specific configurations (if exists)
[ -f ~/.zshrc.local ] && source ~/.zshrc.local

# -----------------------------------------------------------------------------
# Additional Tools (uncomment if installed)
# -----------------------------------------------------------------------------

# Starship prompt (modern, fast alternative to oh-my-zsh themes)
# Install: brew install starship
# eval "$(starship init zsh)"

# Zoxide (modern cd replacement)
# Install: brew install zoxide
# eval "$(zoxide init zsh)"

# atuin (magical shell history)
# Install: brew install atuin
# eval "$(atuin init zsh)"

# thefuck (correct previous command)
# Install: brew install thefuck
# eval $(thefuck --alias)

# -----------------------------------------------------------------------------
# Performance Monitoring (optional - comment out if not needed)
# -----------------------------------------------------------------------------
# Uncomment to measure shell startup time
# zmodload zsh/zprof
# Add at the end of file: zprof
